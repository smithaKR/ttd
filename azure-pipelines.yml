# Basic Azure Pipeline for building job and push to Azure ACR

trigger:
- master

variables:
  project_name: ttd
  job_name: onboardingdemojob
  job_version: 0.1 
  commandline_path: C:/studio # CHANGE WITH YOUR OWN PATH
  
  JAVA_HOME_8_X64: C:\Program Files\RedHat\java-1.8.0-openjdk-1.8.0.262-3
  
jobs:

- job: checkout
  pool: 'default' # ADAPT IF YOU HAVE A AGENT POOL NAME
  displayName: 'Git Checkout'
  continueOnError: false
  steps:
  - checkout: self
    clean: true

- job: build
  pool: 'Default'
  dependsOn: checkout
  displayName: 'Job Build & Publish to ACR'
  continueOnError: false
  steps:
  - task: Maven@3
    inputs:
      mavenPomFile: 'poms/pom.xml' 
      goals: 'package'
      options: '--settings $(commandline_path)/configuration/maven_user_settings.xml -U -DaltDeploymentRepository=snapshots::default::http://prdlnxtara:8081/repository/snapshots/  -e -pl jobs/process/demo/$(job_name)_$(job_version) -am '
      publishJUnitResults: false 
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.8'
      jdkDirectory: '/usr/bin/java'
      mavenVersionOption: path
      mavenDirectory: '/usr/local/src/apache-maven'
      mavenOptions: '-Dgeneration.type=local -Dproduct.path=$(commandline_path) -DaltDeploymentRepository=snapshots::default::http://prdlnxtara:8081/repository/snapshots/ -Xmx3096m -Xmx1024m'
      sonarQubeRunAnalysis: false 
      <?xml version="1.0" encoding="UTF-8"?>
<settings xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd" xmlns="http://maven.apache.org/SETTINGS/1.1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <localRepository>YOUR_PATH/commandline/configuration/.m2/repository</localRepository>
  <servers>
    <server>
      <username>admin</username>
      <password>admin123</password>
      <id>talend-custom-libs-release</id>
    </server>
    <server>
      <username>admin</username>
      <password>admin123</password>
      <id>talend-custom-libs-snapshot</id>
    </server>
    <server>
      <username>admin</username>
      <password>admin123</password>
      <id>release</id>
    </server>
  </servers>
  <profiles>
    <profile>
      <id>nexus</id>
      <repositories>
        <repository>
          <releases />
          <snapshots>
            <enabled>false</enabled>
          </snapshots>
          <id>talend-custom-libs-release</id>
          <name>talend-custom-libs-release</name>
          <url>http://localhost:8081/repository/talend-custom-libs-release</url>
        </repository>
        <repository>
          <releases>
            <enabled>false</enabled>
          </releases>
          <snapshots />
          <id>talend-custom-libs-snapshot</id>
          <name>talend-custom-libs-snapshot</name>
          <url>http://localhost:8081/repository/talend-custom-libs-snapshot</url>
        </repository>
      </repositories>
    </profile>
  </profiles>
  <activeProfiles>
      <activeProfile>nexus</activeProfile>
  </activeProfiles>
</settings>